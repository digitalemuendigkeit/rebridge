---
title: "Auswertung Masterarbeit"
author: "Stefan Ahlers"
date: "11/5/2019"
output:
  html_document: 
    toc: true
    toc_float: true
    code_folding : hide
    df_print : paged
  pdf_document: default
---

<!--- Läd die benötigten Daten -->
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(haven)
library(sjPlot)
library(sjlabelled)
library(kableExtra)
library(knitr)
library(apastats)
```

# Daten laden und bereinigen
<!--- Läd die Daten und speichert sie in "raw" -->
```{r read_data}
raw <- read_sav(file= "data/191104-data.sav")
```

<!--- Bereinigt den Datensatz und speichert ihn in "data_cleaned" -

TODO: O-Sterne Bewertungen in 1-Sterne Bewertungen umformatieren.

-->
```{r cleaning}
data_cleaned <- raw %>% filter(Progress == 100) %>%    select(-StartDate,-EndDate,-Status,-IPAddress,-Duration__in_seconds_,-Progress,-Finished,-RecordedDate,-RecipientEmail,-RecipientFirstName,-RecipientLastName,-ExternalReference,-LocationLatitude,-LocationLongitude,-DistributionChannel,-UserLanguage,-ResponseID.0,-age.0,-gender.0,-topic,-randomTopicQuestion,-title,-body,-itemID,-subtitle,-date,-recsys,-rating,-iteration)  # Es werden nur die vollständigen Datensätze ausgewertet; überflüssige Spalten entfernt

# Einzeltabellen gegliedert nach Themenbereich
data_demograph <- data_cleaned %>% select(ResponseId,gender,age,school,school_5_TEXT,education,education_6_TEXT,) # extrahiert die demographischen Daten
data_newsConsum <- data_cleaned %>% select(ResponseId,starts_with("news"))
data_topicSelect <- data_cleaned %>% select(ResponseId,interestingTopic)
data_publishing <- data_cleaned %>% select(ResponseId,starts_with("RS_dataPublishing"))
data_RS_einschaetzung <- data_cleaned %>% select(ResponseId,starts_with("einsch"))
data_know_austria <- data_cleaned %>% select(ResponseId,knowledge_austria)

```

# Skalen Reliabilität
Im folgenden werden die einzelnen Skalen auf ihre Reliabilität geprüft und ggfs. zusammengefasst.

## Big Five
<!--- Auswertung der Big Five 
      1 = negativ
      6 = positiv
-->
```{r bigFive}
big_df <- data_cleaned %>% select(starts_with("bigf"))

#big_df %>% map(get_label) %>% str_split("-") -> labels_bf 
#for (label in labels_bf){
#  print(label[2])
#}

keys_bf  <- list(offenheit = c("-bigFive_5", "bigFive_10"),
                 gewissenhaft  = c("-bigFive_3", "bigFive_8"),
                 extraversion = c("-bigFive_1", "bigFive_6"),
                 vertraeglich = c("bigFive_2", "-bigFive_7"),
                 neuro = c("bigFive_4", "-bigFive_9"))

result <- psych::scoreItems(keys = keys_bf , big_df)
result
#result$scores

# Reliabilität zu schlecht, daher keine Auswertung!
# data <- bind_cols(data_cleaned, as.data.frame(result$scores))
```
Die Reliabilität von den Offenheit ($\alpha =$ `r result$alpha[1]`) , Gewissenhaftigkeit ($\alpha =$ `r result$alpha[2]`), Verträglichkeit ($\alpha =$ `r result$alpha[4]`) und Neurozität ($\alpha =$ `r result$alpha[5]`) ist jeweils kleiner als $\alpha = .6$. Einzig die Aussagen zur Extraversion ($\alpha =$ `r result$alpha[3]`) weist eine auswertbare Realibität auf. Daher wird auf eine Auswertung der Big Five im Folgenden verzichtet.

## KUT
<!--- Auswertung des KUT 
    1 = sehr geringer KUT
    6 = sehr hoher KUT
-->
```{r KUT}

kut_df <- data_cleaned %>% select(starts_with("kut"))

#kut_df %>% map(get_label) %>% str_split("-") -> labels_bf 

#for (label in labels_bf){
#  print(label[3])
#}

keys_bf  <- list(KUT = c("-kut_1", "-kut_2", "kut_3", "-kut_4", "-kut_5", "-kut_6", "kut_7", "kut_8", "kut_9", "kut_10"))

#result_alpha <- psych::alpha(kut_df, check.keys = TRUE)
#result_alpha

result <- psych::scoreItems(keys = keys_bf , kut_df)
result

#result$scores

data_kut <- data_cleaned %>% select(ResponseId)
data_kut <-bind_cols(data_kut, as.data.frame(result$scores))
```
Der KUT weißt mit ($\alpha =$ `r result$alpha[1]`) eine gute Relibilität auf.

## Privacy RecSys
<!--- Auswertung des RS Privacy 
      1 = sehr geringes Vertrauen in die Privatsphäre
      6 = sehr großes Vertrauen in der Privatsphäre
-->
```{r Privacy_RS}

privacy_df <- data_cleaned %>% select(starts_with("RS_privacy"))

#privacy_df %>% map(get_label) %>% str_split("-") -> labels_bf 
#for (label in labels_bf){
#print(label[3])
#}

keys_bf  <- list(RS_Privacy_Consern = c("-RS_privacy_1","-RS_privacy_2","RS_privacy_3","-RS_privacy_4","RS_privacy_5"))

#result_alpha <- psych::alpha(privacy_df, check.keys = TRUE)
#result_alpha

result <- psych::scoreItems(keys = keys_bf , privacy_df)
result
#result$scores

data_priv <- data_cleaned %>% select(ResponseId)
data_priv <-bind_cols(data_priv, as.data.frame(result$scores))
```

Die Skala zur Einschätzugn der Privatsphäre eines RS weißt mit ($\alpha =$ `r result$alpha[1]`) eine gute Relibilität auf.

## Anlernen
<!--- Auswertung Bewertungen einzenler Artikel beim Anlernen
      1 = sehr schlecht
      6 = sehr gut
-->
```{r Bewertung_SUM_Anlernen}
anlernen_df <- data_cleaned %>% select(starts_with("Anlernen"),starts_with("firstReviewArticles"))

# Neucodieren der einzelnen Artikelbewertungen
anlernen_df$Anlernen1_1<-recode(anlernen_df$Anlernen1_1, `0` = 1, `2` = 2.25, `3` = 3.5, `4` = 4.75, `5` = 6)
anlernen_df$Anlernen2_1<-recode(anlernen_df$Anlernen2_1, `0` = 1, `2` = 2.25, `3` = 3.5, `4` = 4.75, `5` = 6)
anlernen_df$Anlernen3_1<-recode(anlernen_df$Anlernen3_1, `0` = 1, `2` = 2.25, `3` = 3.5, `4` = 4.75, `5` = 6)
anlernen_df$Anlernen4_1<-recode(anlernen_df$Anlernen4_1, `0` = 1, `2` = 2.25, `3` = 3.5, `4` = 4.75, `5` = 6)
anlernen_df$Anlernen5_1<-recode(anlernen_df$Anlernen5_1, `0` = 1, `2` = 2.25, `3` = 3.5, `4` = 4.75, `5` = 6)
anlernen_df$Anlernen6_1<-recode(anlernen_df$Anlernen6_1, `0` = 1, `2` = 2.25, `3` = 3.5, `4` = 4.75, `5` = 6)
anlernen_df$Anlernen7_1<-recode(anlernen_df$Anlernen7_1, `0` = 1, `2` = 2.25, `3` = 3.5, `4` = 4.75, `5` = 6)

keys_bf  <- list(Anlernen_SUM_bew = c("Anlernen1_1","Anlernen2_1","Anlernen3_1","Anlernen4_1","Anlernen5_1","Anlernen6_1","Anlernen7_1"),
                 anlernen_ges_bew = c("firstReviewArticles_1","firstReviewArticles_2","firstReviewArticles_6"))

#result_alpha <- psych::alpha(anlernen_df, check.keys = TRUE)
#result_alpha

result <- psych::scoreItems(keys = keys_bf , anlernen_df)
result
#result$scores

data_anlernen <- data_cleaned %>% select(ResponseId)
data_anlernen <-bind_cols(data_anlernen, as.data.frame(result$scores))


```
Aus den Bewertungen der einzelnen Artikeln, die während des Anlernen der Empfehlungssysteme getätigt werden, lässt sich eine durchschnittliche Bewertung berechnen. Diese durchschnittlich Bewertung weißt mit ($\alpha =$ `r result$alpha[1]`) eine schwache Relibilität der einzelnen Bewertungen auf. 

Aus drei der sieben Aussagen zur Bewertung des Anlernsystems wurde ein Durchschnittswert berechnet, wie gut den Probanden die Artikel gefallen haben. Dieser Durchschnitsswert hat eine gute Reliabilität von ($\alpha =$ `r result$alpha[2]`). Die anderen Aussagen decken andere Dimensionen ab und werden deswegen einzeln weiter betrachtet.

## UBCF
<!--- Auswertung des UBCF Empfehlungssystem
      1 = sehr schlecht
      6 = sehr gut
-->
```{r UBCF}
UBCF_df <- data_cleaned %>% select(starts_with("loop1"),starts_with("UBCF"))

# Neucodieren der einzelnen Artikelbewertungen
UBCF_df$loop1.1_1<-recode(UBCF_df$loop1.1_1, `0` = 1, `2` = 2.25, `3` = 3.5, `4` = 4.75, `5` = 6)
UBCF_df$loop1.2_1<-recode(UBCF_df$loop1.2_1, `0` = 1, `2` = 2.25, `3` = 3.5, `4` = 4.75, `5` = 6)
UBCF_df$loop1.3_1<-recode(UBCF_df$loop1.3_1, `0` = 1, `2` = 2.25, `3` = 3.5, `4` = 4.75, `5` = 6)
UBCF_df$loop1.4_1<-recode(UBCF_df$loop1.4_1, `0` = 1, `2` = 2.25, `3` = 3.5, `4` = 4.75, `5` = 6)

keys_bf  <- list(UBCF_SUM_Artikel = c("loop1.1_1","loop1.2_1","loop1.3_1","loop1.4_1"),
                 UBCF_ges_art_bew = c("UBCF_ArticleReview_1","UBCF_ArticleReview_2","UBCF_ArticleReview_6"),
                 UBCF_RS_bew = c("-UBCF_Review_1","UBCF_Review_2","-UBCF_Review_3","UBCF_Review_4","-UBCF_Review_5"))

result <- psych::scoreItems(keys = keys_bf , UBCF_df)
result
#result$scores

data_UBCF <- data_cleaned %>% select(ResponseId)
data_UBCF <-bind_cols(data_UBCF, as.data.frame(result$scores))

```
Aus den Bewertungen der einzelnen Artikeln, die das UBCF-Empfehlungssystem den Probanden empfohlen hat, lässt sich eine durchschnittliche Bewertung berechnen. Diese durchschnittlich Bewertung weißt mit ($\alpha =$ `r result$alpha[1]`) eine schwache Relibilität der einzelnen Bewertungen auf. 

Aus drei der sechs Aussagen zur Gesamtbewertung der Artikel des UBCF-Empfehlungssystems, wurde ein Durchschnittswert berechnet, wie gut den Probanden die Artikel gefallen haben. Dieser Durchschnitsswert hat eine sehr gute Reliabilität von ($\alpha =$ `r result$alpha[2]`). 

Die anderen Aussagen decken andere Dimensionen ab und werden deswegen einzeln weiter betrachtet.
Die Zusammenfassung der Scala, wie gut die Probanden das UBCF-Empfehlungssystem finden, weißt mit ($\alpha =$ `r result$alpha[3]`) eine gute Reliabilität auf.

## SVD
<!--- Auswertung des SVD Empfehlungssystem
      1 = sehr schlecht
      6 = sehr gut
-->
```{r SVD}
SVD_df <- data_cleaned %>% select(starts_with("loop2"),starts_with("SVD"))

# Neucodieren der einzelnen Artikelbewertungen
SVD_df$loop2.1_1<-recode(SVD_df$loop2.1_1, `0` = 1, `2` = 2.25, `3` = 3.5, `4` = 4.75, `5` = 6)
SVD_df$loop2.2_1<-recode(SVD_df$loop2.2_1, `0` = 1, `2` = 2.25, `3` = 3.5, `4` = 4.75, `5` = 6)
SVD_df$loop2.3_1<-recode(SVD_df$loop2.3_1, `0` = 1, `2` = 2.25, `3` = 3.5, `4` = 4.75, `5` = 6)
SVD_df$loop2.4_1<-recode(SVD_df$loop2.4_1, `0` = 1, `2` = 2.25, `3` = 3.5, `4` = 4.75, `5` = 6)

keys_bf  <- list(SVD_SUM_Artikel = c("loop2.1_1","loop2.2_1","loop2.3_1","loop2.4_1"),
                 SVD_ges_art_bew = c("SVD_articleReview_1","SVD_articleReview_2","SVD_articleReview_6"),
                 SVD_RS_bew = c("-SVD_bewertung_1","SVD_bewertung_2","-SVD_bewertung_3","SVD_bewertung_4","-SVD_bewertung_5"))

result <- psych::scoreItems(keys = keys_bf , SVD_df)
result
#result$scores

data_SVD <- data_cleaned %>% select(ResponseId)
data_SVD <-bind_cols(data_SVD, as.data.frame(result$scores))
```
Aus den Bewertungen der einzelnen Artikeln, die das SVD-Empfehlungssystem den Probanden empfohlen hat, lässt sich eine durchschnittliche Bewertung berechnen. Diese durchschnittlich Bewertung weißt mit ($\alpha =$ `r result$alpha[1]`) eine schwache Relibilität der einzelnen Bewertungen auf. 

Aus drei der sieben Aussagen zur Gesamtbewertung der Artikel des SVD-Empfehlungssystems, wurde ein Durchschnittswert berechnet, wie gut den Probanden die Artikel gefallen haben. Dieser Durchschnitsswert hat eine sehr gute Reliabilität von ($\alpha =$ `r result$alpha[2]`). Die anderen Aussagen decken andere Dimensionen ab und werden deswegen einzeln weiter betrachtet.

Die Zusammenfassung der Scala, wie gut die Probanden das UBCF-Empfehlungssystem finden, weißt mit ($\alpha =$ `r result$alpha[3]`) eine gute Reliabilität auf.

# Deskriptive Statistik 
```{r}
data_demograph  %>% ggplot() + 
                    aes(x = factor(gender)) + 
                    geom_bar(width=.5) + 
                    scale_x_discrete(labels=c(`1` = "männlich", `2` = "weiblich")) +
                    coord_flip()
```

## Geschlecht

```{r gender}
# Definiere Geschlechter und Nutzeranzahl
male <-  table(data_demograph$gender)[1]
female <- table(data_demograph$gender)[2]
divers <- table(data_demograph$gender)[0]
user <- length(data_demograph$ResponseId)
```

Die Teilnehmer der Umfrage waren zu:

* `r female/user*100` % weiblich
* `r male/user*100` % männlich
* `r divers/user*100`0 % divers

## Alter
```{r}
# Alter der Probanden gruppiert #
#   <= 21 Jahre → Gruppe 1      #
# 22 - 35 Jahre → Gruppe 2      #
# 36 - 50 Jahre → Gruppe 3      #
# 50 - 64 Jahre → Gruppe 5      # 
#    > 65 Jahre → Gruppe 6      #

data_demograph <- data_demograph %>% mutate(age_grp = case_when(age < 22 ~ 1, 
                                                                age  < 35 ~ 2,
                                                                age  < 50 ~ 3,
                                                                age  < 65 ~ 4,
                                                                age >= 65 ~ 5))

# Grafische Darstellung
data_demograph  %>% ggplot() + 
                    aes(x = as.numeric(age), fill = factor(gender)) + 
                    geom_bar(position = "stack") + 
                    xlab("Alter") + 
                    ylab("Anzahl") + 
                    scale_fill_discrete(name="Geschlecht",labels=c("männlich", "weiblich"))

psych::describeBy(data_demograph$age, data_demograph$gender)
data_demograph %>% ggplot() + aes(x=as.factor(gender), y=as.numeric(age)) + stat_summary() + stat_ydensity()
```

## Schulbildung
```{r}
data_demograph  %>% ggplot(aes(x = school, 
                               y = ..prop..,
                               fill = factor(gender))) + 
                    geom_bar(position = "dodge") + 
                    geom_text(aes(label = scales::percent(..prop..),      y= ..prop.. ),
                              stat= "count", position = position_dodge(width = 1), hjust = -0.1) +
                    labs(y = "Anzahl", x="Abschluss") +
                    scale_fill_manual(values = c("skyblue","royalblue"),
                                      name="Geschlecht",
                                      labels=c("männlich", "weiblich")) +
                    guides(fill = guide_legend(reverse = TRUE)) +
                    coord_flip(ylim=c(0,0.8))+
                    scale_x_reverse(breaks = 1:5,labels = c("keine Schulausbildung",
                                                            "Volks-/Hauptschulabschluss",
                                                            "Realschulabschluss",
                                                            "(Fach-)Abitur",
                                                            "Sonstiges")) +
                    scale_y_continuous(labels = scales::percent)
```
Von den Befragten haben:

* `r table(data_demograph$school)[1]/user*100` % (noch) keine Schulabschluss
* `r table(data_demograph$school)[2]/user*100` % einen Hauptschulabschluss
* `r table(data_demograph$school)[3]/user*100` % einen Realschulabschluss 
* `r table(data_demograph$school)[4]/user*100` % das (Fach-)Abitur

Die Befragten haben alle ein sehr hohes Bildungsniveau. Insgesamt besitzen `r table(data_demograph$school)[4]/user*100` % das (Fach-)Abitur. Auch zwischen den Geschlechtern ist kein Unterschied erkennbar, so haben `r table(data_demograph$school, data_demograph$gender)[4,1]/male*100` % der männlichen und `r table(data_demograph$school, data_demograph$gender)[4,2]/female*100` % der weiblichen Befragten das Abitur.


## Berufsausbildung
```{r}
data_demograph  %>% ggplot(aes(x = education, 
                               y = ..prop..,
                               fill = factor(gender))) + 
                    geom_bar(position = "dodge") + 
                    geom_text(aes(label = scales::percent(..prop..), y= ..prop.. ),
                              stat= "count", position = position_dodge(width = 1), hjust = -0.1) +
                    labs(y = "Anzahl", x="Abschluss") +
                    scale_fill_manual(values = c("skyblue","royalblue"),
                                      name="Geschlecht",
                                      labels=c("männlich", "weiblich")) +
                    guides(fill = guide_legend(reverse = TRUE)) +
                    coord_flip(ylim=c(0,0.5))+
                    scale_x_reverse(breaks = 1:6,labels = c("keine Ausbildung / Studium abgeschlossen",
                                                            "Ausbildung",
                                                            "Meister",
                                                            "Hochschulabschluss",
                                                            "Promotion",
                                                            "Sonstiges")) +
                    scale_y_continuous(labels = scales::percent)

table(data_demograph$education, data_demograph$gender)[4,1]/male*100
table(data_demograph$education, data_demograph$gender)[4,2]/female*100
```

Von den Befragten haben:

+ `r table(data_demograph$education)[1]/user*100` % noch keine Ausbildung/ kein Studium abgeschlossen
+ `r table(data_demograph$education)[2]/user*100` % eine Ausbildung abgeschlossen
+ `r table(data_demograph$education)[3]/user*100` % einen Meister gemacht
+ `r table(data_demograph$education)[4]/user*100` % einen Hochschulabschluss erworben
+ `r table(data_demograph$education)[5]/user*100` % promoviert


## KUT
```{r}
data_KUT_gender <- inner_join(data_demograph, data_kut, by="ResponseId") %>% select(gender,KUT)

cor(data_KUT_gender$gender, data_KUT_gender$KUT)

KUT_male <- data_KUT_gender %>% filter(gender == 1) %>% select(KUT)
KUT_female <- data_KUT_gender %>% filter(gender == 2) %>% select(KUT)
describe.mean.sd(KUT_male$KUT)
describe.mean.sd(KUT_female$KUT)
describe.mean.sd(data_kut$KUT)
```

Der KUT der Befragten ist mittelmäßig stark ausgeprägt: `r describe.mean.sd(data_kut$KUT)`. Bei der Betrachtung der Geschlechter ist erkennbar, dass die männlichen Befragten einen höherne KUT (`r describe.mean.sd(KUT_male$KUT)`) als die Frauen (`r describe.mean.sd(KUT_female$KUT)`) haben.
 
## Internetportale

```{r}
# Portal 1
portal1_gender <- table(data_newsConsum$newsPortal_1, data_demograph$gender)
sum(portal1_gender)/user
portal1_gender[,1]/male
portal1_gender[,2]/female
```


Von den Befragten nutzen:

* `r table(data_newsConsum$newsPortal_1)/user*100` % die Internetportale des öffentlich-rechtlichen Rundfunks
* `r table(data_newsConsum$newsPortal_2)/user*100` % die Internetportale überregionaler Zeitungen
* `r table(data_newsConsum$newsPortal_3)/user*100` % die Internetportale regionaler Zeitungen
* `r table(data_newsConsum$newsPortal_4)/user*100` % Online-Nachrichtenportale
* `r table(data_newsConsum$newsPortal_5)/user*100` % Suchmaschinen
* `r table(data_newsConsum$newsPortal_6)/user*100` % Soziale Netwerke
* `r table(data_newsConsum$newsPortal_7)/user*100` % sonstige Quellen

um an neue Informationen zu gelangen.

## Internetportale Nutzungszeit
```{r}
# 
apastats::describe.mean.sd(data_newsConsum$newsPortalFrequency_1)
apastats::describe.mean.sd(data_newsConsum$newsPortalFrequency_2)
apastats::describe.mean.sd(data_newsConsum$newsPortalFrequency_3)
apastats::describe.mean.sd(data_newsConsum$newsPortalFrequency_4)
apastats::describe.mean.sd(data_newsConsum$newsPortalFrequency_5)
apastats::describe.mean.sd(data_newsConsum$newsPortalFrequency_6)

# Genderunterschied
portal1_gender <- table(data_newsConsum$newsPortalFrequency_1, data_demograph$gender) 
portal1_gender[,1]/male*100
portal1_gender[,2]/female*100
```






